"""
The `runner.py` module contains the main game loop and logic for the Corner Store Simulator game.

The `Colors` class defines ANSI escape codes for various text colors that can be used to colorize the output.

The `pause()` function pauses the execution of the program for the specified number of seconds.

The `clear_screen()` function clears the terminal screen, working for both Windows and Unix-based systems.

The `typewriter_effect()` function simulates a typewriter-like effect when printing text to the console, with a customizable delay between characters.

The main game loop handles the player's interactions with the NPC characters, including greeting them, checking their inventory, and acquiring and giving items. The loop continues until the player chooses to flee the conversation or the game is completed.

The game also includes a Wordle-like mini-game that the player must complete in order to prepare a slushie for the customer.
"""
# documented code by AI

import time
import os
import sys
from character import Character
from item import Item

# class generated by AI
class Colors:
    BLACK = '\033[30m'
    RED = '\033[31m'
    GREEN = '\033[32m'
    YELLOW = '\033[33m'
    BRIGHT_BLUE = '\033[34m'
    MAGENTA = '\033[35m'
    CYAN = '\033[36m'
    WHITE = '\033[37m'
    BRIGHT_BLACK = '\033[90m'
    BRIGHT_RED = '\033[91m'
    BRIGHT_GREEN = '\033[92m'
    BRIGHT_YELLOW = '\033[93m'
    BRIGHT_BRIGHT_BLUE = '\033[94m'
    BRIGHT_MAGENTA = '\033[95m'
    BRIGHT_CYAN = '\033[96m'
    BRIGHT_WHITE = '\033[97m'
    RESET = '\033[0m'

# generated by AI
def pause(seconds):
    time.sleep(seconds)

# generated by AI
def clear_screen():
    # Check if the system is Windows
    if os.name == 'nt':
        os.system('cls')  # Clear screen for Windows
    else:
        os.system('clear')  # Clear screen for macOS and Linux

# typewriter effect function (generated by AI)
def typewriter_effect(text, delay=0.1, color=Colors.RESET):
    for char in text:
        sys.stdout.write(f"{color}{char}{Colors.RESET}")
        sys.stdout.flush()  # Ensures the output is displayed immediately
        time.sleep(delay)
    print()  # Move to the next line after the text is printed

# first text introduction
print()
typewriter_effect("Welcome to Corner Store Simulator!", delay=0.05, color=Colors.BRIGHT_CYAN)
print()

typewriter_effect("A man walks into the corner store late at night and approaches you at the counter....", delay=0.04, color=Colors.BRIGHT_MAGENTA)
print()

in_conversation = False # AI generated
found_lighters = False # AI generated
conversation_complete = False # AI generated

# all lines in relation to loops were all generated by AI
# the main game loop
while not conversation_complete: # loop statement generated by AI
    # start conversation loop until valid input 'E', 'Q', or 'I' is provided
    while not in_conversation: # loop generated by AI
        d1 = input("Press 'E' to greet them, 'Q' to flee, or 'I' to check your inventory: ").lower()
        player = Character("Man", 100, [], {
            "Hello": ("NPC: Hey, you guys got any lighters here?", Character.Colors.GREEN, 0.04),
            "No": ("YOU: No, but we may have some in the back. I'll go check.", Character.Colors.BRIGHT_BLUE, 0.04),
            "Give": ("YOU: I found a pack in the back.", Character.Colors.BRIGHT_BLUE, 0.04),
            "Goodbye": ("NPC: Thank you, have a good night!", Character.Colors.GREEN, 0.04)
        }) # generated by AI because I didn't know how to implement the typewrieter effect in the character dialogue

        if d1 == "e":
            # user starts talking to the NPC
            player.talk_to_player("Hello")
            in_conversation = True # generated by AI
        elif d1 == "q":
            # flees the conversation
            typewriter_effect("Talking to strangers is too spooky. You hide in the employee bathroom until the customer leaves.", delay=0.04, color=Colors.BRIGHT_YELLOW)
            conversation_complete = True # generated by AI
            break # generated by AI
        elif d1 == "i":
            player.show_inventory() # shows the user's inventory
        else:
            # loops back to the start of the conversation if the user puts in an invalid input
            typewriter_effect("Invalid Input. Press 'E', 'Q', or 'I'.", delay=0.04, color=Colors.RED)
        print()

    if in_conversation: # loop statement generated by AI
        typewriter_effect("You look behind you at the counter, but don't see any lighters.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
        while True: # loop statement generated by AI
            d2 = input("Press 'E' to reply or 'I' to check your inventory: ").lower()
            if d2 == "e":
                player.talk_to_player("No")
                print()
                typewriter_effect("You walk into the backroom but don't know where to look. Left or Right?", delay=0.04, color=Colors.BRIGHT_MAGENTA)
                while not found_lighters: # loop statement generated by AI
                    d2 = input("Press 'L' for left, 'R' for right, or 'I' to check your inventory: ").lower()
                    if d2 == "l":
                        lighters = Item("Lighters", "A pack of lighters", 0)
                        typewriter_effect("You spot a pack of lighters next to the rat's nest in the corner of the backroom.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
                        while True: # loop statement generated by AI
                            d2a = input("Press 'G' to grab the lighters: ").lower()
                            if d2a == "g":
                                found_lighters = True # loop statement generated by AI
                                player.receive_item(lighters)
                                lighters.use_item(player)
                                break # loop statement generated by AI
                            else:
                                typewriter_effect("Invalid Input. Press 'G' to grab the item.", delay=0.04, color=Colors.RED)
                                print()
                        break
                    elif d2 == "r":
                        typewriter_effect("You don't find any lighters and turn back.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
                        print()
                        typewriter_effect("You turn back around. Left or Right?", delay=0.04, color=Colors.BRIGHT_MAGENTA)
                    elif d2 == "i":
                        player.show_inventory()
                        print()
                        continue # loop statement generated by AI
                    else:
                        typewriter_effect("Invalid Input. Press 'L', 'R', or 'I'.", delay=0.04, color=Colors.RED)
                        print()
            elif d2 == "i":
                player.show_inventory()
                print()
                continue # loop statement generated by AI
            else:
                typewriter_effect("Invalid Input. Press 'E' or 'I'.", delay=0.04, color=Colors.RED)
                print()
                continue # loop statement generated by AI
            break

            if found_lighters: # loop statement generated by AI
                break  # loop statement generated by AI
        typewriter_effect("You walk back to the counter to the customer.", delay=0.04, color=Colors.BRIGHT_MAGENTA)        
        while True: # loop statement generated by AI
            d3 = input("Press 'G' to give the lighters to the man or 'I' to check your inventory: ").lower()
            if d3 == "g":
                if lighters in player.inventory: # if statement generated by AI
                    player.inventory.remove(lighters) # generated by AI
                    player.talk_to_player("Give")
                    typewriter_effect("You gave the lighters to the man. He gives you his thanks and pays.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
                    print()
                    while True: # loop statement generated by AI
                        d3a = input("Press 'E' to say goodbye, or 'I' to check your inventory: ").lower()
                        if d3a == "e":
                            player.talk_to_player("Goodbye")
                            typewriter_effect("The man walks out of the store.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
                            pause(3)
                            clear_screen()
                            conversation_complete = True # loop statement generated by AI
                            break
                        elif d3a == "i":
                            player.show_inventory()
                        else:
                            typewriter_effect("Invalid input. Press 'E' to say goodbye or 'I' to check your inventory.", delay=0.04, color=Colors.RED)
                    if conversation_complete: # loop statement generated by AI
                        break # loop statement generated by AI
                else:
                    typewriter_effect("You don't have any lighters.", delay=0.04, color=Colors.RED)
            elif d3 == "i":
                player.show_inventory()
            else:
                typewriter_effect("Invalid Input. Press 'G' or 'I'.", delay=0.04, color=Colors.RED)
            print()
    if conversation_complete: # loop statement generated by AI
    # continue with the next part of the conversation with new npc
        print()
        typewriter_effect("A few moments after the man leaves, a woman walks in....", delay=0.04, color=Colors.BRIGHT_MAGENTA)
        print()

    # generated by AI because I didn't know how to implement the typewriter effect with dialogue
player = Character("Woman", 100, player.inventory, {
            "Hello": ("NPC: Hi there! Can I have a slushie?", Character.Colors.GREEN, 0.04),
            "Q": ("YOU: Sure, what flavor would you like?.", Character.Colors.BRIGHT_BLUE, 0.04),
            "Flavor": ("NPC: Cement flavor please!", Character.Colors.GREEN, 0.04),
            "Order": ("YOU: Alright, give me a few moments to prepare your slushie!", Character.Colors.BRIGHT_BLUE, 0.04),
            "Give_Slush": ("YOU: Here's your slushie ma'am. Have a great day!", Character.Colors.BRIGHT_BLUE, 0.04)
})

outer_loop = True # loop statement generated by AI

while outer_loop: # loop statement generated by AI
    while True: # loop statement generated by AI
        d1a = input("Press 'E' to greet them, 'Q' to flee, or 'I' to check your inventory: ").lower()
        if d1a == "e":
            player.talk_to_player("Hello")
            typewriter_effect("You look behind you to ensure the slushie machine is working. It seems to be working fine.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
            print()
            break # loop statement generated by AI
        elif d1a == "q":
            typewriter_effect("Talking to strangers is too spooky. You hide in the employee bathroom until the customer leaves.", delay=0.04, color=Colors.BRIGHT_YELLOW)
            outer_loop = False # loop statement generated by AI
            break # loop statement generated by AI
        elif d1a == "i":
            player.show_inventory()
        else:
            typewriter_effect("Invalid Input. Press 'E', 'Q', or 'I'.", delay=0.04, color=Colors.RED)
    
    if not outer_loop: # loop statement generated by AI
        break # loop statement generated by AI

    while outer_loop: # loop statement generated by AI
        d1ab = input("Press 'E' to reply or 'I' to check your inventory: ").lower()
        if d1ab == "e":
            player.talk_to_player("Q")
            typewriter_effect("The woman ponders for a moment...", delay=0.03, color=Colors.BRIGHT_MAGENTA)
            player.talk_to_player("Flavor")
            break # loop statement generated by AI
        elif d1ab == "i":
            player.show_inventory()
        else:
            typewriter_effect("Invalid Input. Press 'E' or 'I'.", delay=0.04, color=Colors.RED)
        if not outer_loop: # loop statement generated by AI
            break # loop statement generated by AI

    print()

    while outer_loop: # loop statement generated by AI
        d1ac = input("Press 'E' to reply or 'I' to check your inventory: ").lower()
        if d1ac == "e":
            player.talk_to_player("Order")
            print()
            typewriter_effect("You walk to the back of the counter to the slushie machine.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
            typewriter_effect("Now you must prepare the slushie for the customer.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
            typewriter_effect("To prepare the slushie, you must win a game of Wordle.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
            typewriter_effect("Good Luck!", delay=0.04, color=Colors.BRIGHT_MAGENTA)
            break
        elif d1ac == "i":
            player.show_inventory()
        else:
            typewriter_effect("Invalid Input. Press 'E' or 'I'.", delay=0.04, color=Colors.RED)
        if not outer_loop: # loop statement generated by AI
            break # loop statement generated by AI

    while outer_loop: # loop statement generated by AI
        d1ad = input("Press 'E' to continue or 'I' to check your inventory: ").lower()
        if d1ad == "e":
            clear_screen() 
            from wordle import playWordle
            playWordle()
            break
        elif d1ad == "i":
            player.show_inventory()
        else:
            typewriter_effect("Invalid Input. Press 'E' to continue or 'I' to check your inventory.", delay=0.04, color=Colors.RED)
            print()
        if not outer_loop: # loop statement generated by AI
            break # loop statement generated by AI

    if outer_loop: # loop statement generated by AI
        slushie = Item("Slushie", "Cement flavored", 0)
        player.receive_item(slushie)
        slushie.use_item(player)
        pause(3)
        clear_screen()
        typewriter_effect("You finished the slushie. Good Job!", delay=0.04, color=Colors.BRIGHT_MAGENTA)
        typewriter_effect("You walk back to the counter to the customer.", delay=0.04, color=Colors.BRIGHT_MAGENTA)

        while outer_loop: # loop statement generated by AI
            d1ae = input("Press 'G' to give the slushie or 'I' to check your inventory: ").lower()
            if d1ae == "g":
                player.talk_to_player("Give_Slush")
                player.inventory.remove(slushie) # generated by AI
                typewriter_effect("You give the slushie to the customer.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
                typewriter_effect("The customer thanks you and leaves the store.", delay=0.04, color=Colors.BRIGHT_MAGENTA)
                print()
                outer_loop = False # loop statement generated by AI
                break # loop statement generated by AI
            elif d1ae == "i":
                player.show_inventory()
            else:
                typewriter_effect("Invalid Input. Press 'G', or 'I'.", delay=0.04, color=Colors.RED)
            print()
            if not outer_loop: # loop statement generated by AI
                break # loop statement generated by AI

print()
typewriter_effect("You finished your job for the night. It's time to clock out. See you next time!", delay=0.04, color=Colors.BRIGHT_CYAN)
print()
